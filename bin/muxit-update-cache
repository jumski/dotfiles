#!/usr/bin/env bash

# Create cache directory if it doesn't exist
mkdir -p ~/.cache

# Generate the project list
{
  # Add .dotfiles
  echo ".dotfiles"

  # Add regular git repos from ~/Code
  # Exclude wt-managed repo roots (those with .bare directory)
  # Exclude supatemp parent directory (subdirectories are added separately)
  fd -H --glob .git --no-ignore-vcs --exec echo {//} \; /home/jumski/Code |
  while read -r path; do
    # Skip if directory contains .bare (wt-managed root)
    # Skip supatemp parent directory
    if [[ ! -d "$path/.bare" ]] && [[ "$path" != "/home/jumski/Code/pgflow-dev/supatemp" ]]; then
      echo "$path"
    fi
  done |
  sed 's|/home/jumski/Code/||'

  # Add supatemp subdirectories
  supatemp_dir="/home/jumski/Code/pgflow-dev/supatemp"
  if [[ -d "$supatemp_dir" ]]; then
    for subdir in "$supatemp_dir"/*/ ; do
      if [[ -d "$subdir" ]]; then
        basename=$(basename "$subdir")
        echo "pgflow-dev/supatemp/$basename"
      fi
    done
  fi
} | sort -u > ~/.cache/muxit-projects