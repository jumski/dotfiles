{"id":".dotfiles-1k4.4","title":"Test mDNS resolution for VMs","description":"Verify VMs are reachable via .local mDNS domain (e.g., installer.local). Run: avahi-resolve-host-name installer.local","notes":"Per-VM: mDNS hostname already set in vmw_spawn.fish via cloud-init (line 72-73: local-hostname: $vm_name). Avahi-daemon must be installed in golden image. Consider adding avahi-daemon install to install.sh's golden image setup or document it in golden image creation docs.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T12:11:56.343795887+01:00","created_by":"jumski","updated_at":"2026-01-15T17:55:15.108962175+01:00","close_reason":"Closed","deleted_at":"2026-01-15T17:55:15.108962175+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"dotfiles-1k4","title":"Epic: Create KVM Claude farm","status":"open","priority":0,"issue_type":"epic","created_at":"2026-01-01T12:11:40.512658849+01:00","created_by":"jumski","updated_at":"2026-01-01T12:13:26.496899554+01:00"}
{"id":"dotfiles-1k4.1","title":"Update vmw_spawn.fish to use br0 bridge","description":"Changed BRIDGE_NAME from virbr0 to br0 in vmw_spawn.fish for mDNS support","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T12:11:55.767555301+01:00","created_by":"jumski","updated_at":"2026-01-01T12:13:26.500460933+01:00","closed_at":"2026-01-01T12:12:06.571211035+01:00","close_reason":"Changed BRIDGE_NAME from virbr0 to br0 in vmw_spawn.fish line 134","dependencies":[{"issue_id":"dotfiles-1k4.1","depends_on_id":"dotfiles-1k4","type":"parent-child","created_at":"2026-01-01T12:11:55.772714092+01:00","created_by":"jumski"}]}
{"id":"dotfiles-1k4.2","title":"Add bridge setup to vmw install.sh","description":"Added section 8b: Create br0 bridge using NetworkManager, section 8c: Configure QEMU bridge ACL","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T12:11:55.960748965+01:00","created_by":"jumski","updated_at":"2026-01-01T12:13:26.499563751+01:00","closed_at":"2026-01-01T12:12:06.737447885+01:00","close_reason":"Added sections 8b (bridge creation) and 8c (QEMU ACL) to vmw/install.sh","dependencies":[{"issue_id":"dotfiles-1k4.2","depends_on_id":"dotfiles-1k4","type":"parent-child","created_at":"2026-01-01T12:11:55.961893894+01:00","created_by":"jumski"}]}
{"id":"dotfiles-1k4.3","title":"Activate br0 bridge on host","description":"Run: nmcli connection down 'Wired connection 1' \u0026\u0026 nmcli connection up br0. This moves enp24s0 to br0 for L2 network access.","notes":"DECISION: Move bridge activation to vmw/install.sh as one-time setup. Consider adding auto-activation prompt or separate activation script. Per-VM commands belong in vmw_spawn.fish (already handles virtiofsd, VM define/start).","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-01T12:11:56.140389591+01:00","created_by":"jumski","updated_at":"2026-01-01T13:03:40.850475754+01:00","closed_at":"2026-01-01T13:03:40.850475754+01:00","close_reason":"Added bridge activation prompt to vmw/install.sh with SSH detection, confirmation, and connectivity verification","dependencies":[{"issue_id":"dotfiles-1k4.3","depends_on_id":"dotfiles-1k4","type":"parent-child","created_at":"2026-01-01T12:11:56.141573609+01:00","created_by":"jumski"}]}
{"id":"dotfiles-1k4.4","title":"Test mDNS resolution for VMs","description":"Verify VMs are reachable via .local mDNS domain (e.g., installer.local). Run: avahi-resolve-host-name installer.local","notes":"Per-VM: mDNS hostname already set in vmw_spawn.fish via cloud-init (line 72-73: local-hostname: $vm_name). Avahi-daemon must be installed in golden image. Consider adding avahi-daemon install to install.sh's golden image setup or document it in golden image creation docs.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-01T12:11:56.343795887+01:00","created_by":"jumski","updated_at":"2026-01-15T17:44:31.055557268+01:00","closed_at":"2026-01-15T17:44:31.055557268+01:00","close_reason":"Closed","dependencies":[{"issue_id":"dotfiles-1k4.4","depends_on_id":"dotfiles-1k4","type":"parent-child","created_at":"2026-01-01T12:11:56.344972126+01:00","created_by":"jumski"},{"issue_id":"dotfiles-1k4.4","depends_on_id":"dotfiles-1k4.3","type":"blocks","created_at":"2026-01-01T12:12:06.91153673+01:00","created_by":"jumski"}]}
{"id":"dotfiles-1k4.5","title":"Test VM spawning and SSH access","description":"Test full workflow: vmw spawn \u003cworktree\u003e, wait for boot, ssh claude@\u003cname\u003e.local, verify virtiofs mounts work","notes":"Per-VM: vmw_spawn.fish already handles disk clone, cloud-init ISO, virtiofsd daemons, VM define/start. Test full flow. If fixes needed, update vmw/functions/vmw_spawn.fish.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-01T12:11:56.539520698+01:00","created_by":"jumski","updated_at":"2026-01-01T12:14:17.729500383+01:00","dependencies":[{"issue_id":"dotfiles-1k4.5","depends_on_id":"dotfiles-1k4","type":"parent-child","created_at":"2026-01-01T12:11:56.540657417+01:00","created_by":"jumski"},{"issue_id":"dotfiles-1k4.5","depends_on_id":"dotfiles-1k4.3","type":"blocks","created_at":"2026-01-01T12:12:07.085510527+01:00","created_by":"jumski"}]}
{"id":"dotfiles-526","title":"VMW: add fish completions","description":"Add tab completion for vmw subcommands (spawn, ssh, list, stop, destroy) and dynamic VM name completion using virsh list.","design":"Create `/home/jumski/.dotfiles/vmw/completions.fish` for tab completion of vmw subcommands and VM names.\n\n## Completion Requirements\n\n### Subcommands (first argument)\n- `spawn` - Create VM with optional writable paths\n- `ssh` - SSH into VM\n- `list` - List all VMs (no args)\n- `stop` - Graceful shutdown\n- `destroy` - Force stop and remove\n\n### Dynamic Completions\n\n**For `vmw ssh`, `vmw stop`, `vmw destroy`:**\n- Complete VM names from `virsh list --all --name`\n- Also check `~/.config/vmw/instances/` for instance dirs\n\n**For `vmw spawn`:**\n- Second arg: VM name (free-form, no completion needed)\n- Subsequent args: Paths under `~/Code` (use `__fish_complete_directories`)\n\n## Implementation\n\nCreate file: `vmw/completions.fish`\n\n```fish\ncomplete -c vmw -f\n\ncomplete -c vmw -n __fish_use_subcommand -a spawn -d \"Create VM with optional writable paths\"\ncomplete -c vmw -n __fish_use_subcommand -a ssh -d \"SSH into VM\"\ncomplete -c vmw -n __fish_use_subcommand -a list -d \"List all VMs\"\ncomplete -c vmw -n __fish_use_subcommand -a stop -d \"Gracefully shutdown VM\"\ncomplete -c vmw -n __fish_use_subcommand -a destroy -d \"Force stop and remove VM\"\n\n# VM name completion for ssh, stop, destroy\ncomplete -c vmw -n \"__fish_seen_subcommand_from ssh stop destroy\" \\\n  -a \"(virsh list --all --name 2\u003e/dev/null; ls -1 ~/.config/vmw/instances/ 2\u003e/dev/null)\" \\\n  -d \"VM\"\n\n# Path completion for spawn (2nd arg onwards)\ncomplete -c vmw -n \"__fish_seen_subcommand_from spawn\" -xa \"(__fish_complete_directories)\"\n\n# No arguments for list\ncomplete -c vmw -n \"__fish_seen_subcommand_from list\" -f\n```\n\n## Files to Create\n\n| File | Purpose |\n|------|---------|\n| `vmw/completions.fish` | Fish completions for vmw |\n\n## Testing\n\nAfter creating, test:\n```fish\nsource vmw/completions.fish\nvmw \u003ctab\u003e          # should show: spawn ssh list stop destroy\nvmw ssh \u003ctab\u003e      # should show VM names\nvmw spawn \u003cname\u003e ~/C\u003ctab\u003e  # should complete ~/Code/\n```\n","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T07:30:36.961392734+01:00","created_by":"jumski","updated_at":"2026-01-06T07:30:40.944999109+01:00"}
{"id":"dotfiles-9k6","title":"VMW: writable paths + user mirroring","description":"Refactor vmw_spawn to:\n- Use jumski user with /home/jumski/Code structure (mirroring host)\n- Mount ~/Code as read-only by default (full codebase access)\n- Accept positional args as writable paths (overlay rw on ro base)\n- Merge vmw-mounts branch work for ~/.claude/ mounting\n\nNew CLI: vmw spawn \u003cvm-name\u003e [writable-path...]","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-05T08:08:26.885884386+01:00","created_by":"jumski","updated_at":"2026-01-05T08:08:35.333088451+01:00"}
{"id":"dotfiles-kqu","title":"Hive: arbitrary paths + window naming prompt","description":"## Problem\nHive only opens muxit worktrees by default and window naming silently auto-suffixes without user input, which can lead to confusing behavior when names collide (e.g., dotfiles -\u003e dotfiles-2 -\u003e dotfiles-3 should be created reliably).\n\n## Goals\n- Allow arbitrary directories across all Hive commands (spawn/session/window/split) via `--path` and interactive selection.\n- Always prompt for a window name when creating a new window in the spawn wizard, with a preselected default you can accept by pressing Enter.\n- Provide explicit `--session-name` and `--window-name` flags for consistent overrides across commands.\n- Fix window name collisions so they always create a new unique name instead of silently skipping.\n\n## UX / Flow\n### Path selection (new picker)\n- Replace/extend `_hive_pick_worktree` with `_hive_pick_path`.\n- Options shown in order, with the first option preselected:\n  1. `Current directory` (uses `pwd`)\n  2. `Custom path` (prompt for arbitrary directory)\n  3. Muxit worktrees from `~/.cache/muxit-projects` resolved via `_hive_resolve_path`\n- Selected path must exist; resolve via `realpath`. Cancel returns empty.\n\n### Spawn wizard\n- Step 1: Path selection uses `_hive_pick_path` (unless `--path` provided).\n- Step 2: Destination selection (new session vs existing hive session) unchanged.\n- Step 3: Window selection for existing session:\n  - If `--window-name` provided: skip step 3 and always create a new window with that name.\n  - Otherwise, show \"[+] New Window\" vs existing windows. If \"New Window\" chosen, prompt for name.\n- `--session-name` in spawn:\n  - If it matches an existing hive session, use it as the destination session.\n  - If it does not exist, create a new hive session with that name.\n\n### Window naming prompt\n- New helper `_hive_next_window_name \u003csession\u003e \u003cbase\u003e` returns the first available name: `name`, `name-2`, `name-3`, etc.\n- New helper `_hive_prompt_window_name \u003csession\u003e \u003cbase\u003e`:\n  - Compute `suggested` via `_hive_next_window_name`.\n  - Use fzf to choose between:\n    - the suggested name (preselected)\n    - `Custom name`\n  - If \"Custom name\" chosen, prompt for input; empty input falls back to `suggested`.\n  - If custom name collides, auto-suffix via `_hive_next_window_name` (no re-prompt).\n\n## Flags\n- Add `--path` to `hive spawn`, `hive session`, `hive window`, `hive split`.\n- Add `--session-name` and `--window-name` to `hive spawn`, `hive session`, `hive window`.\n- Preserve positional path compatibility for all commands.\n- Use `argparse` for consistent parsing.\n\n## Command behavior\n- `hive session`:\n  - Uses `--session-name` override for session creation.\n  - Uses `--window-name` override for the first window (auto-suffix if collision is somehow possible).\n  - Errors if session already exists (unchanged).\n- `hive window`:\n  - Accepts `--session-name` (default: current session).\n  - Prompts for window name if `--window-name` is not provided.\n  - Auto-suffixes name on collisions (no silent failure).\n- `hive split`:\n  - Accepts `--path` for arbitrary directories.\n  - Still requires running inside a hive tmux session.\n\n## Help updates\n- Update `hive/functions/hive.fish` and per-command `--help` to document new flags and picker behavior.\n\n## Files to change\n- `hive/lib/common.fish`\n- `hive/functions/hive_spawn.fish`\n- `hive/functions/hive_window.fish`\n- `hive/functions/hive_session.fish`\n- `hive/functions/hive_split.fish`\n- `hive/functions/hive.fish`\n- `hive/tests/common.test.fish`\n\n## Tests\n- Add tests for `_hive_next_window_name` in `hive/tests/common.test.fish`:\n  - no conflicts -\u003e base name\n  - single conflict -\u003e `name-2`\n  - multiple conflicts -\u003e `name-3`, `name-4`, etc.\n- Run `script/test wt` (or `script/test`) before finalizing.\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:36:51.608694403+01:00","created_by":"jumski","updated_at":"2026-01-15T14:49:00.39242471+01:00","closed_at":"2026-01-15T14:49:00.39242471+01:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"dotfiles-kqu","author":"jumski","text":"Implementation summary:\n- Added _hive_pick_path (Current dir preselected, Custom path prompt, muxit worktrees), --path flag support across spawn/session/window/split.\n- Added _hive_next_window_name + _hive_prompt_window_name, and --session-name/--window-name flags.\n- Spawn wizard now prompts for window name (suggested name preselected), skips window picker when --window-name set.\n- Window naming now auto-suffixes to avoid collisions (fixes dotfiles/dotfiles-2/dotfiles-3 issue).\n- Updated command help text and added basic tests.\n\nCurrent debugging:\n- In tmux popup flow, after confirming suggested name, no new window appears. Menus render correctly.\n- Need to confirm whether tmux new-window is failing or window is created but not selected. Next step: check `tmux list-windows` after wizard; compare with direct `hive window` and raw `tmux new-window` commands to isolate.","created_at":"2026-01-15T13:28:45Z"},{"id":2,"issue_id":"dotfiles-kqu","author":"jumski","text":"Fixed popup window creation issue. Root cause: spawn called hive_window without --window-name, causing double fzf prompting which fails in popup context. Fix: spawn wizard now prompts for window name and passes via --window-name.","created_at":"2026-01-15T13:48:56Z"},{"id":3,"issue_id":"dotfiles-kqu","author":"jumski","text":"Final fix: Added -a flag to tmux new-window to append at next available index (was failing with 'index in use' error in popup context). Also improved Custom path picker to use fzf --walker for interactive directory browsing.","created_at":"2026-01-15T14:18:00Z"}]}
{"id":"dotfiles-sb2","title":"Add mksupa path and switch commands","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-13T12:22:19.539393176+01:00","created_by":"jumski","updated_at":"2026-01-13T12:37:36.878435613+01:00","closed_at":"2026-01-13T12:37:36.878435613+01:00","close_reason":"Closed"}
{"id":"dotfiles-svd","title":"Reorganize worktree management for agentic coding","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T19:29:30.753607991+01:00","created_by":"jumski","updated_at":"2026-01-09T17:34:37.051942117+01:00","closed_at":"2026-01-09T17:34:37.051942117+01:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"dotfiles-svd","author":"jumski","text":"## Original Request\n\nUser wants to reorganize tmux workflow for better agentic coding productivity with ultrawide monitor (5000px wide).\n\n### Current Pain Points\n- One tmux SESSION per worktree = slow session switching\n- Context scattered across multiple sessions\n- No visibility into agent activity across worktrees\n\n### Goals\n- Single session (or session-per-repo at most)\n- Multiple windows within session, each window = one worktree\n- Notification hooks to mark windows with activity icons\n- Better visibility with ultrawide monitor\n- Flexibility: window-per-worktree OR multiple panes per window\n\n### Flexibility Requirements\n1. Window-per-worktree mode (each window has one worktree + agent)\n2. Multi-pane mode (2-3 worktrees in split panes within a window)\n3. Soft default: session-per-repo (all worktrees from same repo in one session)\n4. Tmux menu integration for quick worktree selection","created_at":"2026-01-08T18:29:42Z"},{"id":5,"issue_id":"dotfiles-svd","author":"jumski","text":"## Implementation Plan v1.0\n\n### Language Choice\n- **Fish** for all hive commands (consistent with wt, testable with fishtape)\n- **TypeScript** for OpenCode notification plugin (required by OpenCode)\n\n---\n\n### Module Structure\n\n```\nhive/\n‚îú‚îÄ‚îÄ hive.fish                    # Bootstrap (sources lib)\n‚îú‚îÄ‚îÄ lib/\n‚îÇ   ‚îî‚îÄ‚îÄ common.fish              # Shared utilities\n‚îú‚îÄ‚îÄ functions/\n‚îÇ   ‚îú‚îÄ‚îÄ hive.fish                # Main dispatcher\n‚îÇ   ‚îú‚îÄ‚îÄ hive_spawn.fish          # Interactive wizard\n‚îÇ   ‚îú‚îÄ‚îÄ hive_session.fish        # Create hive session\n‚îÇ   ‚îú‚îÄ‚îÄ hive_window.fish         # Add window to session\n‚îÇ   ‚îú‚îÄ‚îÄ hive_split.fish          # Split current window\n‚îÇ   ‚îî‚îÄ‚îÄ _hive_*.fish             # Internal helpers\n‚îú‚îÄ‚îÄ completions.fish\n‚îî‚îÄ‚îÄ tests/\n    ‚îî‚îÄ‚îÄ *.test.fish\n\nopencode/plugin/\n‚îî‚îÄ‚îÄ hive-notify.ts               # Notification plugin\n```\n\n---\n\n### Core Commands\n\n| Command | Description |\n|---------|-------------|\n| `hive spawn` | Interactive wizard: pick worktree ‚Üí pick session (or new) ‚Üí pick window (or new) |\n| `hive session \u003cworktree\u003e` | Create new hive session from worktree's repo |\n| `hive window \u003cworktree\u003e` | Add window to current hive session |\n| `hive split \u003cworktree\u003e` | Split current window with new worktree pane |\n\n---\n\n### Spawn Wizard Flow\n\n```\n1. fzf: Select worktree\n   ‚Üì\n2. fzf: Select destination\n   - [New Session] ‚Üí creates session named {repo}, window named {worktree}\n   - {existing hive sessions listed} ‚Üí step 3\n   ‚Üì\n3. fzf: Select window target (only if existing session chosen)\n   - [New Window] ‚Üí creates window named {worktree}\n   - {existing windows listed} ‚Üí splits selected window\n```\n\n---\n\n### Session Marker\n\n```bash\n# Set on session creation\ntmux set-option @hive true\n\n# Check in scripts\ntmux show-options -qv @hive  # returns 'true' or empty\n```\n\n---\n\n### Notification System\n\n**Badge Icons:**\n- `üîê` Permission prompt\n- `‚è≥` Idle/waiting for input\n- `‚ùå` Error\n- `üí¨` Generic activity\n\n**Logic:**\n1. Agent fires notification\n2. If target pane is focused ‚Üí do nothing\n3. Else ‚Üí prepend badge to window name (if not present)\n4. If current session ‚â† target session ‚Üí also send system notification\n5. On window focus ‚Üí strip badge prefix\n\n**Implementation:**\n- OpenCode plugin hooks `session.idle`, `session.error`, `permission.updated`\n- Plugin calls `~/.dotfiles/hive/scripts/notify.sh` with JSON payload\n- `notify.sh` checks `@hive` option, applies badge, optionally sends system notification\n- tmux `focus-in` hook calls `~/.dotfiles/hive/scripts/clear-badge.sh`\n\n---\n\n### tmux Integration\n\n```conf\n# In shortcuts.conf or new hive.conf\nbind h popup -E -w 60% -h 60% 'fish -C \"hive spawn \u0026\u0026 exit 0\"'\n\n# Focus hook for badge clearing (in settings.conf or hive.conf)\nset-hook -g window-focus-in 'run-shell -b ~/.dotfiles/hive/scripts/clear-badge.sh'\n```\n\n---\n\n### OpenCode Plugin (hive-notify.ts)\n\n```typescript\nexport const HiveNotifyPlugin = async ({ $, directory, worktree }) =\u003e {\n  return {\n    event: async ({ event }) =\u003e {\n      const notifyScript = '~/.dotfiles/hive/scripts/notify.sh'\n      \n      if (event.type === 'session.idle') {\n        await $\\`\\${notifyScript} --type idle --message 'Waiting for input'\\`\n      }\n      if (event.type === 'session.error') {\n        await $\\`\\${notifyScript} --type error --message 'Session error'\\`\n      }\n      if (event.type === 'permission.updated') {\n        await $\\`\\${notifyScript} --type permission --message 'Permission needed'\\`\n      }\n    }\n  }\n}\n```\n\n---\n\n### Coexistence with Legacy\n\n- `wt` commands remain untouched (creates session-per-worktree)\n- `claude.fish` wrapper remains untouched\n- `notify-hook.sh` (Claude) checks `@hive` option:\n  - If `@hive=true` ‚Üí use new badge+notification logic\n  - Else ‚Üí current behavior\n- Both systems can run in parallel\n\n---\n\n### Implementation Order\n\n1. **Phase 1: Core Structure**\n   - Create hive/ module skeleton\n   - Implement `hive session` (create marked session)\n   - Implement `hive window` (add window)\n   - Implement `hive split` (split pane)\n\n2. **Phase 2: Spawn Wizard**\n   - Implement `hive spawn` with fzf integration\n   - Add tmux popup binding\n\n3. **Phase 3: Notifications**\n   - Create `notify.sh` script\n   - Create `clear-badge.sh` script\n   - Add tmux focus hook\n   - Create OpenCode plugin\n\n4. **Phase 4: Polish**\n   - Fish completions\n   - Tests\n   - Documentation\n\n---\n\n### Open Questions (Resolved)\n\n- ‚úÖ Language: Fish + TypeScript for plugin\n- ‚úÖ Tool name: hive\n- ‚úÖ Session marker: `@hive true`\n- ‚úÖ Badge icons: üîê‚è≥‚ùåüí¨\n- ‚úÖ Keybind: prefix + h\n- ‚úÖ Auto-launch: No, just cd to worktree for now","created_at":"2026-01-08T19:08:44Z"},{"id":6,"issue_id":"dotfiles-svd","author":"jumski","text":"## Final Decisions (from discussion)\n\n### Resolved Questions\n\n1. **Worktree picker scope**: Same source as muxit (`~/.cache/muxit-projects` + wt worktrees)\n2. **Window naming when splitting**: Keep as-is (first pane's worktree name)\n3. **Session listing**: Only show hive sessions (`@hive=true`)\n4. **Running outside tmux**: Show selector like muxit ‚Üí open in new hive session\n5. **OpenCode plugin location**: Global at `~/.config/opencode/plugin/hive-notify.ts` (symlinked from dotfiles for version control)\n\n### Architecture Clarification\n\nThe unit of work is the **pane**:\n- 1 pane = 1 worktree + 1 agent\n- Windows can have multiple panes (different worktrees)\n- Window name = first pane's worktree name (even with splits)\n- All panes in a window share notification badge\n\n### Session Naming\n- Session name = repo name (e.g., `pgflow`, `dotfiles`)\n- Window name = worktree name (e.g., `main`, `feat-auth`)\n- Different from muxit which uses `worktree@repo` for sessions\n\n### Spawn Wizard Flow (Refined)\n\n```\nhive spawn\n    ‚Üì\n[1] fzf: Select worktree (from muxit cache + wt worktrees)\n    ‚Üì\n[2] fzf: Select destination\n    - \"[+] New Session\" ‚Üí creates session, done\n    - {list of existing hive sessions} ‚Üí step 3\n    ‚Üì\n[3] fzf: Select window target (only if existing session chosen)\n    - \"[+] New Window\" ‚Üí creates window, done\n    - {list of windows in selected session} ‚Üí splits that window\n```\n\n### File Locations\n\n```\n~/.dotfiles/hive/                    # Main module\n‚îú‚îÄ‚îÄ hive.fish\n‚îú‚îÄ‚îÄ lib/common.fish\n‚îú‚îÄ‚îÄ functions/*.fish\n‚îú‚îÄ‚îÄ scripts/\n‚îÇ   ‚îú‚îÄ‚îÄ notify.sh                    # Called by OpenCode plugin\n‚îÇ   ‚îî‚îÄ‚îÄ clear-badge.sh               # Called by tmux focus hook\n‚îî‚îÄ‚îÄ tests/*.test.fish\n\n~/.dotfiles/opencode/plugin/         # OpenCode plugins (in dotfiles)\n‚îî‚îÄ‚îÄ hive-notify.ts                   # Symlinked to ~/.config/opencode/plugin/\n\n~/.config/opencode/plugin/           # Where OpenCode looks\n‚îî‚îÄ‚îÄ hive-notify.ts ‚Üí ~/.dotfiles/opencode/plugin/hive-notify.ts\n```","created_at":"2026-01-08T19:17:38Z"},{"id":7,"issue_id":"dotfiles-svd","author":"jumski","text":"## Technical Implementation Details\n\n### 1. Worktree/Project Source\n\nUses same source as muxit:\n- Cache file: `~/.cache/muxit-projects`\n- Updated by: `muxit-update-cache` (bash script using fd)\n- Contains: `.dotfiles`, regular repos from `~/Code`, supatemp projects\n\nFor hive, we also need worktrees from wt-managed repos. The picker should combine:\n1. `~/.cache/muxit-projects` entries\n2. Worktrees detected via `*/worktrees/*` pattern\n\n### 2. Session Name Derivation\n\nGiven a selected path, derive repo name:\n\n```fish\n# .dotfiles ‚Üí 'dotfiles'\n# ~/Code/org/repo ‚Üí 'repo' (just basename, not org/repo)\n# ~/Code/org/repo/worktrees/feature ‚Üí 'repo' (parent of worktrees dir)\n```\n\nThis differs from muxit which uses `org/repo` or `worktree@repo`.\n\n### 3. Worktree Name Derivation\n\nGiven a selected path, derive worktree/window name:\n\n```fish\n# .dotfiles ‚Üí 'dotfiles' (special case, same as session)\n# ~/Code/org/repo ‚Üí 'main' (default for non-worktree repos)\n# ~/Code/org/repo/worktrees/feature ‚Üí 'feature' (basename)\n```\n\n### 4. hive_session Implementation\n\n```fish\nfunction hive_session\n    set -l worktree_path $argv[1]\n    \n    # Derive names\n    set -l session_name (_hive_get_session_name $worktree_path)\n    set -l window_name (_hive_get_window_name $worktree_path)\n    \n    # Check if session exists\n    if tmux has-session -t \"=$session_name\" 2\u003e/dev/null\n        echo \"Session '$session_name' already exists\"\n        return 1\n    end\n    \n    # Create session with @hive marker\n    if test -n \"$TMUX\"\n        tmux new-session -d -c \"$worktree_path\" -s \"$session_name\"\n        tmux set-option -t \"$session_name\" @hive true\n        tmux rename-window -t \"$session_name:1\" \"$window_name\"\n        tmux switch-client -t \"$session_name\"\n    else\n        tmux new-session -d -c \"$worktree_path\" -s \"$session_name\"\n        tmux set-option -t \"$session_name\" @hive true\n        tmux rename-window -t \"$session_name:1\" \"$window_name\"\n        tmux attach-session -t \"$session_name\"\n    end\nend\n```\n\n### 5. hive_window Implementation\n\n```fish\nfunction hive_window\n    set -l worktree_path $argv[1]\n    set -l session_name $argv[2]  # Optional, defaults to current\n    \n    if test -z \"$session_name\"\n        set session_name (tmux display-message -p '#S')\n    end\n    \n    # Verify it's a hive session\n    if test (tmux show-options -t \"$session_name\" -qv @hive) != 'true'\n        echo \"Error: '$session_name' is not a hive session\"\n        return 1\n    end\n    \n    set -l window_name (_hive_get_window_name $worktree_path)\n    \n    tmux new-window -t \"$session_name\" -n \"$window_name\" -c \"$worktree_path\"\nend\n```\n\n### 6. hive_split Implementation\n\n```fish\nfunction hive_split\n    set -l worktree_path $argv[1]\n    \n    # Verify we're in a hive session\n    set -l session_name (tmux display-message -p '#S')\n    if test (tmux show-options -t \"$session_name\" -qv @hive) != 'true'\n        echo \"Error: Not in a hive session\"\n        return 1\n    end\n    \n    # Horizontal split (side-by-side columns)\n    tmux split-window -h -c \"$worktree_path\"\nend\n```\n\n### 7. hive_spawn Wizard Implementation\n\n```fish\nfunction hive_spawn\n    # Step 1: Select worktree\n    set -l worktree_path (_hive_pick_worktree)\n    if test -z \"$worktree_path\"\n        return 0  # User cancelled\n    end\n    \n    # Step 2: Select destination\n    set -l hive_sessions (_hive_list_sessions)\n    set -l destination (_hive_pick_destination $hive_sessions)\n    \n    switch $destination\n        case 'new-session'\n            hive_session \"$worktree_path\"\n        case 'cancel'\n            return 0\n        case '*'\n            # Selected existing session, go to step 3\n            set -l session_name $destination\n            set -l windows (_hive_list_windows $session_name)\n            set -l window_target (_hive_pick_window $windows)\n            \n            switch $window_target\n                case 'new-window'\n                    hive_window \"$worktree_path\" \"$session_name\"\n                case 'cancel'\n                    return 0\n                case '*'\n                    # Selected existing window, split it\n                    tmux select-window -t \"$session_name:$window_target\"\n                    hive_split \"$worktree_path\"\n            end\n    end\nend\n```\n\n### 8. Helper Functions\n\n```fish\nfunction _hive_list_sessions\n    # List only sessions with @hive=true\n    tmux list-sessions -F '#{session_name}' 2\u003e/dev/null | while read session\n        if test (tmux show-options -t \"$session\" -qv @hive) = 'true'\n            echo $session\n        end\n    end\nend\n\nfunction _hive_list_windows\n    set -l session_name $argv[1]\n    tmux list-windows -t \"$session_name\" -F '#{window_index}:#{window_name}'\nend\n\nfunction _hive_pick_worktree\n    # Use muxit cache + add any missing worktrees\n    cat ~/.cache/muxit-projects | fzf --prompt='Worktree: '\n    # TODO: resolve to full path\nend\n\nfunction _hive_pick_destination\n    # $argv = list of existing hive sessions\n    set -l options '[+] New Session' $argv\n    printf '%s\\n' $options | fzf --prompt='Destination: ' | read choice\n    \n    if test \"$choice\" = '[+] New Session'\n        echo 'new-session'\n    else if test -z \"$choice\"\n        echo 'cancel'\n    else\n        echo $choice\n    end\nend\n\nfunction _hive_pick_window\n    # $argv = list of windows (index:name format)\n    set -l options '[+] New Window' $argv\n    printf '%s\\n' $options | fzf --prompt='Window: ' | read choice\n    \n    if test \"$choice\" = '[+] New Window'\n        echo 'new-window'\n    else if test -z \"$choice\"\n        echo 'cancel'\n    else\n        # Extract window index\n        echo $choice | cut -d: -f1\n    end\nend\n```\n\n### 9. notify.sh Script\n\n```bash\n#!/bin/bash\n# Called by OpenCode plugin with: --type \u003ctype\u003e --message \u003cmsg\u003e\n\n# Parse args\nwhile [[ $# -gt 0 ]]; do\n    case $1 in\n        --type) NOTIFY_TYPE=\"$2\"; shift 2 ;;\n        --message) MESSAGE=\"$2\"; shift 2 ;;\n        *) shift ;;\n    esac\ndone\n\n# Must be in tmux\nif [ -z \"$TMUX\" ]; then\n    notify-send \"OpenCode\" \"$MESSAGE\"\n    exit 0\nfi\n\n# Get current context\nSESSION=$(tmux display-message -p '#S')\nWINDOW=$(tmux display-message -p '#I')\nPANE=$(tmux display-message -p '#P')\n\n# Check if this is a hive session\nIS_HIVE=$(tmux show-options -t \"$SESSION\" -qv @hive)\nif [ \"$IS_HIVE\" != 'true' ]; then\n    # Fallback to legacy behavior or simple notification\n    notify-send \"OpenCode\" \"$MESSAGE\"\n    exit 0\nfi\n\n# Check if target pane is focused\nACTIVE_PANE=$(tmux display-message -p '#{pane_active}')\nif [ \"$ACTIVE_PANE\" = '1' ]; then\n    exit 0  # Focused, no notification needed\nfi\n\n# Select badge icon\ncase \"$NOTIFY_TYPE\" in\n    permission) BADGE='üîê' ;;\n    idle)       BADGE='‚è≥' ;;\n    error)      BADGE='‚ùå' ;;\n    *)          BADGE='üí¨' ;;\nesac\n\n# Prepend badge to window name (if not already present)\nWINDOW_NAME=$(tmux display-message -p '#W')\nif [[ \"$WINDOW_NAME\" != \"$BADGE\"* ]]; then\n    tmux rename-window \"$BADGE $WINDOW_NAME\"\nfi\n\n# Check if we need system notification (different session focused)\nATTACHED_SESSION=$(tmux display-message -p '#{client_session}')\nif [ \"$ATTACHED_SESSION\" != \"$SESSION\" ]; then\n    notify-send -u normal \"OpenCode: $SESSION\" \"$MESSAGE\"\nfi\n```\n\n### 10. clear-badge.sh Script\n\n```bash\n#!/bin/bash\n# Called by tmux focus-in hook\n\n# Must be in tmux\n[ -z \"$TMUX\" ] \u0026\u0026 exit 0\n\n# Get window name\nWINDOW_NAME=$(tmux display-message -p '#W')\n\n# Strip any badge prefix (emoji + space at start)\n# Badges: üîê ‚è≥ ‚ùå üí¨\nCLEAN_NAME=$(echo \"$WINDOW_NAME\" | sed -E 's/^[üîê‚è≥‚ùåüí¨] //')\n\nif [ \"$CLEAN_NAME\" != \"$WINDOW_NAME\" ]; then\n    tmux rename-window \"$CLEAN_NAME\"\nfi\n```\n\n### 11. tmux Configuration Addition\n\n```conf\n# ~/.dotfiles/tmux/hive.conf (new file, sourced from tmux.conf.symlink)\n\n# Hive spawn popup\nbind h popup -E -w 60% -h 60% 'fish -C \"hive spawn \u0026\u0026 exit 0\"'\n\n# Badge clearing on window focus\nset-hook -g window-focus-in 'run-shell -b ~/.dotfiles/hive/scripts/clear-badge.sh'\n```\n\n### 12. OpenCode Plugin\n\n```typescript\n// ~/.dotfiles/opencode/plugin/hive-notify.ts\n\nexport const HiveNotifyPlugin = async ({ $ }: { $: any }) =\u003e {\n  const notifyScript = process.env.HOME + '/.dotfiles/hive/scripts/notify.sh'\n  \n  return {\n    event: async ({ event }: { event: { type: string } }) =\u003e {\n      switch (event.type) {\n        case 'session.idle':\n          await $`${notifyScript} --type idle --message 'Waiting for input'`\n          break\n        case 'session.error':\n          await $`${notifyScript} --type error --message 'Session error'`\n          break\n        case 'permission.updated':\n          await $`${notifyScript} --type permission --message 'Permission needed'`\n          break\n      }\n    }\n  }\n}\n```\n\n### 13. Dotbot/Symlink Setup\n\nAdd to install.conf.yaml or relevant dotbot config:\n```yaml\n- link:\n    ~/.config/opencode/plugin/hive-notify.ts: opencode/plugin/hive-notify.ts\n```\n\n### 14. Fish Autoload Setup\n\nAdd to fish config loading:\n```fish\n# In fish/config.fish or similar\nsource ~/.dotfiles/hive/hive.fish\n```\n\nOr ensure `hive/functions/` is in fish_function_path.","created_at":"2026-01-08T19:20:16Z"},{"id":8,"issue_id":"dotfiles-svd","author":"jumski","text":"## Implementation Complete\n\nCreated the hive module with all planned functionality:\n\n### Core Structure\n- `hive/hive.fish` - Bootstrap file\n- `hive/lib/common.fish` - Shared utilities and helpers\n- `hive/functions/` - All command functions (autoloaded by fish)\n\n### Commands Implemented\n- `hive spawn` - Interactive wizard with fzf (prefix + h in tmux)\n- `hive session \u003cpath\u003e` - Create new hive-marked session\n- `hive window \u003cpath\u003e [session]` - Add window to hive session\n- `hive split \u003cpath\u003e` - Split current window with new worktree pane\n- `hive list` - List all hive sessions and their windows\n\n### Notification System\n- `scripts/notify.sh` - Badge notifications for tmux windows\n- `scripts/clear-badge.sh` - Clears badge on window focus\n- Badge format: `[R]`, `[I]`, `[!]`, `[A]` for permission/idle/error/activity\n- System notifications when viewing different session\n\n### Tmux Integration\n- `hive.conf` - Keybinding (prefix + h) and focus hook\n- Added to `tmux.conf.symlink`\n\n### OpenCode Plugin\n- `opencode/plugin/hive-notify.ts` - Fires notifications on session events\n- Symlinked via dotbot to `~/.config/opencode/plugin/`\n\n### Tests\n- `tests/common.test.fish` - Tests for name derivation helpers\n\n### Key Design Decisions\n- Session name = repo name (e.g., `pgflow`, `dotfiles`)\n- Window name = worktree name (e.g., `feat-auth`, `main`)\n- Sessions marked with `@hive=true` option\n- Uses muxit cache for worktree picker\n- Coexists with legacy wt/muxit session naming","created_at":"2026-01-08T19:28:31Z"}]}
{"id":"dotfiles-x9l","title":"Convert language codes [EN]/[PL] to flag emojis in dictation script","description":"Replace [EN]/[PL] language codes with flag emojis (üá¨üáß/üáµüá±) in dictation script animations. See comments for technical notes about multi-byte emoji handling to prevent flickering.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-05T22:48:44.04441113+01:00","created_by":"jumski","updated_at":"2026-01-05T22:49:36.646877662+01:00","comments":[{"id":9,"issue_id":"dotfiles-x9l","author":"jumski","text":"Technical context: Flag emojis are 2 Unicode characters (regional indicator pairs). When animating, improper string handling causes flickering. See locations in dictate.py: lines 136-137 (Listening) and 195/199 (Transcribing).","created_at":"2026-01-05T21:49:33Z"}]}
