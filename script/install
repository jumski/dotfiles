#!/usr/bin/env bash
#
# Run all dotfiles installers.

export current_user=jumski

set -e

cd "$(dirname $0)"/..

log_section() {
  local grey="\033[0;37m"
  local blue="\033[0;34m"
  local reset="\033[0m"

  echo -e "${grey}"
  echo
  echo -e "=== ${blue}$1${grey}"
  echo -e ==============================================================${reset}
}

if sudo -n true 2>/dev/null >/dev/null; then
  echo -e "\033[0;32mSudo unlocked, proceeding further\033[0m"
else
  echo -e "\033[0;31mUnlock sudo now to not be surprised by sudo prompts later\033[0m"
  sudo -v
fi

### Install pacman packages before everything
log_section script/install_pacman_packages
script/install_pacman_packages

### Run special installers first, so rest can depend on them
find . -executable -name priority_install.sh | while read installer; do log_section "${installer}"; sh -c "${installer}"; done

### Run rest of installers
find . -executable -name install.sh | while read installer; do log_section "${installer}"; sh -c "${installer}"; done

# link everything
log_section .dotbot/install
.dotbot/install
